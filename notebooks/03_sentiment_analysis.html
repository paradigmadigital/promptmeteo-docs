<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Flan-t5-Small - Test Classification Prompts" href="04_test_flant5_classification_prompts.html" /><link rel="prev" title="Promptmeteo Usage - Save and Load Model" href="01_promptmeteo_usage.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>Sentiment Analysis - üî•üßî</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">üî•üßî</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">üî•üßî</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../definition.html">ü§î What is this library for?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">‚öôÔ∏è Installation and configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">‚ö° Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../classes.html">üëª Classes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_promptmeteo_usage.html">Promptmeteo Usage - Save and Load Model</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Sentiment Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_test_flant5_classification_prompts.html">Flan-t5-Small - Test Classification Prompts</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_test_openai_classification_prompts.html">OpenAI - Test Classification Prompts</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_test_openai_api-generation.html">OpenAI - Test API Generation</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="Sentiment-Analysis">
<h1>Sentiment Analysis<a class="headerlink" href="#Sentiment-Analysis" title="Permalink to this heading">#</a></h1>
<p>In this notebook we are going to use the <strong>Amazon Review Dataset</strong> to test Promptmeteo in the sentiment analysis task</p>
<section id="1.-Data-Preparation---EN---Build-sentiment-dataset.">
<h2>1. Data Preparation - EN - Build sentiment dataset.<a class="headerlink" href="#1.-Data-Preparation---EN---Build-sentiment-dataset." title="Permalink to this heading">#</a></h2>
<p>The dataset contains reviews from Amazon in English collected between November 1, 2015 and November 1, 2019. Each record in the dataset contains the review text, the review title, the star rating, an anonymized reviewer ID, an anonymized product ID and the coarse-grained product category (e.g. ‚Äòbooks‚Äô, ‚Äòappliances‚Äô, etc.). The corpus is balanced across stars, so each star rating constitutes 20% of the reviews in each language.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;../data/amazon_reviews_en/amazon_reviews_multi-test.parquet&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 8)</small><table border="1" class="dataframe"><thead><tr><th>review_id</th><th>product_id</th><th>reviewer_id</th><th>stars</th><th>review_body</th><th>review_title</th><th>language</th><th>product_category</th></tr><tr><td>str</td><td>str</td><td>str</td><td>i32</td><td>str</td><td>str</td><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;en_0199937&quot;</td><td>&quot;product_en_090‚Ä¶</td><td>&quot;reviewer_en_00‚Ä¶</td><td>1</td><td>&quot;These are AWFU‚Ä¶</td><td>&quot;Don‚Äôt waste yo‚Ä¶</td><td>&quot;en&quot;</td><td>&quot;apparel&quot;</td></tr><tr><td>&quot;en_0863335&quot;</td><td>&quot;product_en_034‚Ä¶</td><td>&quot;reviewer_en_06‚Ä¶</td><td>1</td><td>&quot;I bought 4 and‚Ä¶</td><td>&quot;One Star&quot;</td><td>&quot;en&quot;</td><td>&quot;other&quot;</td></tr><tr><td>&quot;en_0565010&quot;</td><td>&quot;product_en_035‚Ä¶</td><td>&quot;reviewer_en_09‚Ä¶</td><td>1</td><td>&quot;On first use i‚Ä¶</td><td>&quot;Totally useles‚Ä¶</td><td>&quot;en&quot;</td><td>&quot;other&quot;</td></tr><tr><td>&quot;en_0963290&quot;</td><td>&quot;product_en_058‚Ä¶</td><td>&quot;reviewer_en_02‚Ä¶</td><td>1</td><td>&quot;You want an HO‚Ä¶</td><td>&quot;Gold filled ea‚Ä¶</td><td>&quot;en&quot;</td><td>&quot;jewelry&quot;</td></tr><tr><td>&quot;en_0238156&quot;</td><td>&quot;product_en_048‚Ä¶</td><td>&quot;reviewer_en_05‚Ä¶</td><td>1</td><td>&quot;The glue works‚Ä¶</td><td>&quot;Poor container‚Ä¶</td><td>&quot;en&quot;</td><td>&quot;industrial_sup‚Ä¶</td></tr></tbody></table></div></div>
</div>
<p>For building a sentiment analysis dataset with the dataset we create the <strong>target</strong> using the variable <code class="docutils literal notranslate"><span class="pre">stars</span></code>. We supone that the reviews with low stars rate are related with negative sentiment and those with high starts rate are related with positive sentiment.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">SQLContext</span><span class="p">()</span>
<span class="n">sql</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="n">sentiment_data</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">        review_body as REVIEW,</span>
<span class="s2">        CASE</span>
<span class="s2">            WHEN stars=1 THEN &#39;negative&#39;</span>
<span class="s2">            WHEN stars=3 THEN &#39;neutral&#39;</span>
<span class="s2">            WHEN stars=5 THEN &#39;positive&#39;</span>
<span class="s2">            ELSE null</span>
<span class="s2">        END AS TARGET,</span>
<span class="s2">    FROM data</span>
<span class="s2">    WHERE stars!=2 AND stars!=4;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">fraction</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">sentiment_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 2)</small><table border="1" class="dataframe"><thead><tr><th>REVIEW</th><th>TARGET</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;I reuse my Nes‚Ä¶</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;Fits great kin‚Ä¶</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;Movie freezes ‚Ä¶</td><td>&quot;negative&quot;</td></tr><tr><td>&quot;This is my thi‚Ä¶</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;For the money,‚Ä¶</td><td>&quot;neutral&quot;</td></tr></tbody></table></div></div>
</div>
</section>
<section id="2.1.-Classification---EN---Model-text-davinci-003">
<h2>2.1. Classification - EN - Model text-davinci-003<a class="headerlink" href="#2.1.-Classification---EN---Model-text-davinci-003" title="Permalink to this heading">#</a></h2>
<section id="2.1.1-Instanciate-Model">
<h3>2.1.1 Instanciate Model<a class="headerlink" href="#2.1.1-Instanciate-Model" title="Permalink to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">promptmeteo</span> <span class="kn">import</span> <span class="n">DocumentClassifier</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">DocumentClassifier</span><span class="p">(</span>
    <span class="n">language</span>             <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">model_name</span>           <span class="o">=</span> <span class="s1">&#39;gpt-3.5-turbo-instruct&#39;</span><span class="p">,</span>
    <span class="n">model_provider_name</span>  <span class="o">=</span> <span class="s1">&#39;openai&#39;</span><span class="p">,</span>
    <span class="n">model_provider_token</span> <span class="o">=</span> <span class="s1">&#39;sk-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span>  <span class="c1">#OPENAI TOKEN</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="2.1.2-Classification-Prompt-template">
<h3>2.1.2 Classification Prompt template<a class="headerlink" href="#2.1.2-Classification-Prompt-template" title="Permalink to this heading">#</a></h3>
<p>Promptmeteo has predefined prompt templates for each of the availables languages, models and tasks. This allows the user not to wonder about defining the prefect prompt but rather, to parametrize the prompt with the parameters of the use case. For the document classification task in english with OpenAI, the prompt template is:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">prompt</span><span class="o">.</span><span class="n">PROMPT_EXAMPLE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
#  Copyright (c) 2023 Paradigma Digital S.L.

#  Permission is hereby granted, free of charge, to any person obtaining a copy
#  of this software and associated documentation files (the &#34;Software&#34;), to deal
#  in the Software without restriction, including without limitation the rights
#  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
#  copies of the Software, and to permit persons to whom the Software is
#  furnished to do so, subject to the following conditions:

#  The above copyright notice and this permission notice shall be included in
#  all copies or substantial portions of the Software.

#  THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
#  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
#  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
#  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
#  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
#  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
#  THE SOFTWARE.


TEMPLATE:
    &#34;I need you to help me with a text classification task.
    {__PROMPT_DOMAIN__}
    {__PROMPT_LABELS__}
    {__SHOT_EXAMPLES__}

    {__CHAIN_THOUGHT__}
    {__ANSWER_FORMAT__}&#34;


PROMPT_DOMAIN:
    &#34;The texts you will be processing are from the {__DOMAIN__} domain.&#34;


PROMPT_LABELS:
    &#34;I want you to classify the texts into one of the following categories:
    {__LABELS__}.&#34;


PROMPT_DETAIL:
    &#34;&#34;

SHOT_EXAMPLES:
    &#34;{__EXAMPLES__}&#34;


CHAIN_THOUGHT:
    &#34;Please provide a step-by-step argument for your answer, explain why you
    believe your final choice is justified, and make sure to conclude your
    explanation with the name of the class you have selected as the correct
    one, in lowercase and without punctuation.&#34;


ANSWER_FORMAT:
    &#34;In your response, include only the name of the class as a single word, in
    lowercase, without punctuation, and without adding any other statements or
    words.&#34;

</pre></div></div>
</div>
</section>
<section id="2.1.3-Train-the-model">
<h3>2.1.3 Train the model<a class="headerlink" href="#2.1.3-Train-the-model" title="Permalink to this heading">#</a></h3>
<p>The training process create a vector database in memory with <strong>FAISS</strong>, the main advantage of using this king of vector database is that it is serializable to a file and be stored in disk, which allows us to save the vectors training process as a model artifact</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_reviews</span> <span class="o">=</span> <span class="n">sentiment_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;REVIEW&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">train_targets</span> <span class="o">=</span> <span class="n">sentiment_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;TARGET&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="n">train_reviews</span><span class="p">,</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="n">train_targets</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="2.1.4-Predict-new-data">
<h3>2.1.4 Predict new data<a class="headerlink" href="#2.1.4-Predict-new-data" title="Permalink to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="n">test_reviews</span> <span class="o">=</span> <span class="n">sentiment_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;REVIEW&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">test_targets</span> <span class="o">=</span> <span class="n">sentiment_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;TARGET&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="n">pred_targets</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_reviews</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pred_targets</span><span class="p">]),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_03_sentiment_analysis_17_1.png" src="../_images/notebooks_03_sentiment_analysis_17_1.png" />
</div>
</div>
</section>
</section>
<section id="2.2.-Classification---EN---Model-Flan-T5-XXL">
<h2>2.2. Classification - EN - Model Flan-T5-XXL<a class="headerlink" href="#2.2.-Classification---EN---Model-Flan-T5-XXL" title="Permalink to this heading">#</a></h2>
<section id="2.2.1-Results">
<h3>2.2.1 Results<a class="headerlink" href="#2.2.1-Results" title="Permalink to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DocumentClassifier</span><span class="p">(</span>
    <span class="n">language</span>             <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">model_name</span>           <span class="o">=</span> <span class="s1">&#39;google/flan-t5-xxl&#39;</span><span class="p">,</span>
    <span class="n">model_provider_name</span>  <span class="o">=</span> <span class="s1">&#39;hf_hub_api&#39;</span><span class="p">,</span>
    <span class="n">model_provider_token</span> <span class="o">=</span> <span class="s1">&#39;hf_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span>  <span class="c1">#HF API TOKEN</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="n">train_reviews</span><span class="p">,</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="n">train_targets</span>
<span class="p">)</span>

<span class="n">pred_targets</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_reviews</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="n">pred_targets</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_03_sentiment_analysis_20_1.png" src="../_images/notebooks_03_sentiment_analysis_20_1.png" />
</div>
</div>
</section>
</section>
<section id="2.3.-Classification---EN---Falcon-7b-instruct">
<h2>2.3. Classification - EN - Falcon-7b-instruct<a class="headerlink" href="#2.3.-Classification---EN---Falcon-7b-instruct" title="Permalink to this heading">#</a></h2>
<section id="2.3.1-Results">
<h3>2.3.1 Results<a class="headerlink" href="#2.3.1-Results" title="Permalink to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DocumentClassifier</span><span class="p">(</span>
    <span class="n">language</span>             <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">model_name</span>           <span class="o">=</span> <span class="s1">&#39;tiiuae/falcon-7b-instruct&#39;</span><span class="p">,</span>
    <span class="n">model_provider_name</span>  <span class="o">=</span> <span class="s1">&#39;hf_hub_api&#39;</span><span class="p">,</span>
    <span class="n">model_provider_token</span> <span class="o">=</span> <span class="s1">&#39;hf_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span>  <span class="c1">#HF API TOKEN</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="n">train_reviews</span><span class="p">,</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="n">train_targets</span>
<span class="p">)</span>

<span class="n">pred_targets</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_reviews</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="n">pred_targets</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
You&#39;re using a different task than the one specified in the repository. Be sure to know what you&#39;re doing :)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_03_sentiment_analysis_26_2.png" src="../_images/notebooks_03_sentiment_analysis_26_2.png" />
</div>
</div>
</section>
</section>
<section id="2.4.-Classification---EN---Model-Flan-t5-small">
<h2>2.4. Classification - EN - Model Flan-t5-small<a class="headerlink" href="#2.4.-Classification---EN---Model-Flan-t5-small" title="Permalink to this heading">#</a></h2>
<section id="2.4.1-Results">
<h3>2.4.1 Results<a class="headerlink" href="#2.4.1-Results" title="Permalink to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DocumentClassifier</span><span class="p">(</span>
    <span class="n">language</span>             <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">model_name</span>           <span class="o">=</span> <span class="s1">&#39;google/flan-t5-small&#39;</span><span class="p">,</span>
    <span class="n">model_provider_name</span>  <span class="o">=</span> <span class="s1">&#39;hf_pipeline&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="n">train_reviews</span><span class="p">,</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="n">train_targets</span>
<span class="p">)</span>

<span class="n">pred_targets</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_reviews</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="n">pred_targets</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Token indices sequence length is longer than the specified maximum sequence length for this model (603 &gt; 512). Running this sequence through the model will result in indexing errors
/opt/conda/lib/python3.10/site-packages/transformers/generation/utils.py:1270: UserWarning: You have modified the pretrained model configuration to control generation. This is a deprecated strategy to control generation and will be removed soon, in a future version. Please use a generation configuration file (see https://huggingface.co/docs/transformers/main_classes/text_generation )
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_03_sentiment_analysis_32_2.png" src="../_images/notebooks_03_sentiment_analysis_32_2.png" />
</div>
</div>
</section>
</section>
<section id="3.-Data-Preparation---SP---Build-sentiment-dataset.">
<h2>3. Data Preparation - SP - Build sentiment dataset.<a class="headerlink" href="#3.-Data-Preparation---SP---Build-sentiment-dataset." title="Permalink to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;../data/amazon_reviews_sp/amazon_reviews_multi-test.parquet&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">sql</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">SQLContext</span><span class="p">()</span>
<span class="n">sql</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="n">sentiment_data</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">        review_body as REVIEW,</span>
<span class="s2">        CASE</span>
<span class="s2">            WHEN stars=1 THEN &#39;negative&#39;</span>
<span class="s2">            WHEN stars=3 THEN &#39;neutral&#39;</span>
<span class="s2">            WHEN stars=5 THEN &#39;positive&#39;</span>
<span class="s2">            ELSE null</span>
<span class="s2">        END AS TARGET,</span>
<span class="s2">    FROM data</span>
<span class="s2">    WHERE stars!=2 AND stars!=4;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">fraction</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">sentiment_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 2)</small><table border="1" class="dataframe"><thead><tr><th>REVIEW</th><th>TARGET</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;El filtro de d‚Ä¶</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;Un poquito esc‚Ä¶</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;Para qu√© decir‚Ä¶</td><td>&quot;negative&quot;</td></tr><tr><td>&quot;Mi hija esta e‚Ä¶</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;Se podr√≠a mejo‚Ä¶</td><td>&quot;neutral&quot;</td></tr></tbody></table></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_reviews</span> <span class="o">=</span> <span class="n">sentiment_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;REVIEW&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">train_targets</span> <span class="o">=</span> <span class="n">sentiment_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;TARGET&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="n">test_reviews</span> <span class="o">=</span> <span class="n">sentiment_data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;REVIEW&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">test_targets</span> <span class="o">=</span> <span class="n">sentiment_data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;TARGET&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="4.1-Classification---SP---Model-text-davinci-003">
<h2>4.1 Classification - SP - Model text-davinci-003<a class="headerlink" href="#4.1-Classification---SP---Model-text-davinci-003" title="Permalink to this heading">#</a></h2>
<section id="4.1.1-Results">
<h3>4.1.1 Results<a class="headerlink" href="#4.1.1-Results" title="Permalink to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DocumentClassifier</span><span class="p">(</span>
    <span class="n">language</span>             <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">model_name</span>           <span class="o">=</span> <span class="s1">&#39;gpt-3.5-turbo-instruct&#39;</span><span class="p">,</span>
    <span class="n">model_provider_name</span>  <span class="o">=</span> <span class="s1">&#39;openai&#39;</span><span class="p">,</span>
    <span class="n">model_provider_token</span> <span class="o">=</span> <span class="s1">&#39;sk-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span>  <span class="c1">#OPENAI TOKEN</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="n">train_reviews</span><span class="p">,</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="n">train_targets</span>
<span class="p">)</span>

<span class="n">pred_targets</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_reviews</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pred_targets</span><span class="p">]),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_03_sentiment_analysis_44_1.png" src="../_images/notebooks_03_sentiment_analysis_44_1.png" />
</div>
</div>
</section>
</section>
<section id="4.2-Classificaction---SP---Flan-t5-small">
<h2>4.2 Classificaction - SP - Flan-t5-small<a class="headerlink" href="#4.2-Classificaction---SP---Flan-t5-small" title="Permalink to this heading">#</a></h2>
<section id="4.2.1-Results">
<h3>4.2.1 Results<a class="headerlink" href="#4.2.1-Results" title="Permalink to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DocumentClassifier</span><span class="p">(</span>
    <span class="n">language</span>             <span class="o">=</span> <span class="s1">&#39;es&#39;</span><span class="p">,</span>
    <span class="n">model_name</span>           <span class="o">=</span> <span class="s1">&#39;google/flan-t5-small&#39;</span><span class="p">,</span>
    <span class="n">model_provider_name</span>  <span class="o">=</span> <span class="s1">&#39;hf_pipeline&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="n">train_reviews</span><span class="p">,</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="n">train_targets</span>
<span class="p">)</span>

<span class="n">pred_targets</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_reviews</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="n">pred_targets</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_03_sentiment_analysis_50_1.png" src="../_images/notebooks_03_sentiment_analysis_50_1.png" />
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="04_test_flant5_classification_prompts.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Flan-t5-Small - Test Classification Prompts</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="01_promptmeteo_usage.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Promptmeteo Usage - Save and Load Model</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023 - 2024, Paradigma Digital
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Sentiment Analysis</a><ul>
<li><a class="reference internal" href="#1.-Data-Preparation---EN---Build-sentiment-dataset.">1. Data Preparation - EN - Build sentiment dataset.</a></li>
<li><a class="reference internal" href="#2.1.-Classification---EN---Model-text-davinci-003">2.1. Classification - EN - Model text-davinci-003</a><ul>
<li><a class="reference internal" href="#2.1.1-Instanciate-Model">2.1.1 Instanciate Model</a></li>
<li><a class="reference internal" href="#2.1.2-Classification-Prompt-template">2.1.2 Classification Prompt template</a></li>
<li><a class="reference internal" href="#2.1.3-Train-the-model">2.1.3 Train the model</a></li>
<li><a class="reference internal" href="#2.1.4-Predict-new-data">2.1.4 Predict new data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.2.-Classification---EN---Model-Flan-T5-XXL">2.2. Classification - EN - Model Flan-T5-XXL</a><ul>
<li><a class="reference internal" href="#2.2.1-Results">2.2.1 Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.3.-Classification---EN---Falcon-7b-instruct">2.3. Classification - EN - Falcon-7b-instruct</a><ul>
<li><a class="reference internal" href="#2.3.1-Results">2.3.1 Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.4.-Classification---EN---Model-Flan-t5-small">2.4. Classification - EN - Model Flan-t5-small</a><ul>
<li><a class="reference internal" href="#2.4.1-Results">2.4.1 Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#3.-Data-Preparation---SP---Build-sentiment-dataset.">3. Data Preparation - SP - Build sentiment dataset.</a></li>
<li><a class="reference internal" href="#4.1-Classification---SP---Model-text-davinci-003">4.1 Classification - SP - Model text-davinci-003</a><ul>
<li><a class="reference internal" href="#4.1.1-Results">4.1.1 Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#4.2-Classificaction---SP---Flan-t5-small">4.2 Classificaction - SP - Flan-t5-small</a><ul>
<li><a class="reference internal" href="#4.2.1-Results">4.2.1 Results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=e936e8a8"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>